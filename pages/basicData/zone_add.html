<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>基础档案</title>
		<link rel="stylesheet" type="text/css" href="../../layui/css/layui.css">
	</head>

	<body>
		<div class="layui-form">
			<table style="width: 98%;margin-left: 7px;">
				<tr>
					<td colspan="2" style="text-align: center;">
						<div class="layui-tab layui-tab-card" style="width: 100%;">
							<ul class="layui-tab-title">
								<li class="layui-this">定区信息</li>
								<li>关联地址列表</li>
								<li>关联小件员列表</li>
							</ul>
							<div class="layui-tab-content" style="height: 230px;">
								<div class="layui-tab-item layui-show">
									<table class="layui-table" style="width: 98%;margin: 1px auto;text-align: center;">
										<tr>
											<td class="layui-bg-gray" width="13%">定区编码</td>
											<td width="20%">
												<input type="text" id="zoneCode" name="title" placeholder="请输入定区编码" autocomplete="off" class="layui-input">
											</td>
											<td class="layui-bg-gray" width="13%">定区名称</td>
											<td width="20%">
												<input type="text" id="name" name="title" placeholder="请输入定区名称" autocomplete="off" class="layui-input">
											</td>
										</tr>
										<tr>
											<td class="layui-bg-gray" width="13%">定区负责人</td>
											<td width="20%">
												<input type="text" id="people" name="title" placeholder="请输入收派标准" autocomplete="off" class="layui-input">
											</td>
											<td class="layui-bg-gray" width="13%">联系电话</td>
											<td width="20%">
												<input type="text" id="tel" name="title" placeholder="请输入收派标准" autocomplete="off" class="layui-input">
											</td>
										</tr>
										<tr>
											<td class="layui-bg-gray" width="13%">所属单位</td>
											<td width="20%">
												<select name="city" id="dw" lay-verify="required">
													<option value="">请选择</option>
												</select>
											</td>
											<td class="layui-bg-gray" width="13%"></td>
											<td width="20%">

											</td>
										</tr>
										<tr height="56.25px">
											<td class="layui-bg-gray" width="13%"></td>
											<td width="20%">

											</td>
											<td class="layui-bg-gray" width="13%"></td>
											<td width="20%">

											</td>
										</tr>
									</table>
								</div>
								<div class="layui-tab-item">
									<table width="100%" height="230px">
										<tr>
											<td style="width: 100px;height: 1px;" align="right"></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
										</tr>
										<tr>
											<td colspan="6">
												<div style="margin-left: 15%;" id="test4" class="demo-transfer"></div>
											</td>
										</tr>
									</table>
								</div>
								<div class="layui-tab-item">
									<table width="100%" height="230px">
										<tr>
											<td style="width: 100px;height: 1px;" align="right"></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
										</tr>
										<tr>
											<td colspan="6">
												<div style="margin-left: 15%;" id="test3" class="demo-transfer"></div>
											</td>
										</tr>
									</table>
								</div>
							</div>
						</div>
					</td>
				</tr>
				<tr>
					<td><button class="layui-btn" lay-demotransferactive="getData" type="button" id="baocun" style="background: #1da02b;margin-left:70%;">确定</button></td>
					<td><button type="button" id="quxiao" class="layui-btn layui-btn-primary" style="margin-left:10%;">取消</button></td>
				</tr>
			</table>
		</div>
		<script type="text/javascript" src="../../custom/jquery.min.js"></script>
		<script type="text/javascript" src="../../layui/layui.js"></script>
		<script type="text/javascript" src="../js/jquery.cookie.js"></script>
		<script type="text/javascript" src="../js/bos.js"></script>
		<script type="text/javascript">
			var id;
			var data3=[];
			var da3;
			
			var da4;
			var data4=[];
			var da;
			var d3=[];
			var d4=[];
			function child(d) {
				if(d!=null){
					id=d.id;
					console.log(d);
					$("#zoneCode").val(d.zoneCode);
					$("#name").val(d.zoneName);
					$("#people").val(d.syEmp.empName);
					$("#tel").val(d.telPhone);
					layui.use('form', function(){
					   var form=layui.form;
					   $("#dw").val(d.syUnits.id);
					   form.render();
					});
					$.ajax({
						url: url + 'basAssociateMemberController/findBasAssociateMemberByZoneCode',
						type: 'post',
						data:{
							"zoneCode":d.zoneCode
						},
						async: false,
						success: function(data) {
							da3=data;
							console.log(data);
						}
					});
					$.ajax({
						url: url + 'basPartitionController/findBasPartitionByTerm',
						type: 'post',
						data:{
							"city":d.zoneName
						},
						async: false,
						success: function(data) {
							da4=data;
							console.log(data);
						}
					});
					layui.use(['transfer', 'layer', 'util'], function() {
						var $ = layui.$,
							transfer = layui.transfer,
							layer = layui.layer,
							util = layui.util;
						//模拟数据
						
						for (var i = 0; i < da3.length; i++) {
							if(da3[i].zoneCode!=null&&da3[i].zoneCode!=""){
								d3.push(da3[i].id);
							}
							data3.push({"value": da3[i].id,
								"title": da3[i].empName});
						}
						for (var i = 0; i < da4.length; i++) {
							if(da4[i].zoneCode!=null&&da4[i].zoneCode!=""){
								d4.push(da4[i].id);
							}
							data4.push({"value": da4[i].id,
								"title": da4[i].county});
						}
						//初始右侧数据
						transfer.render({
							elem: '#test4',
							data: data4,
							height: 220,
							id: 'keyAddress',
							title: ['该定区未关联地址', '该定区已关联地址'],
							value: d4
						})
						transfer.render({
							elem: '#test3',
							data: data3,
							height: 220,
							id: 'yuan',
							title: ['该定区未小件员', '该定区已关联小件员'],
							value: d3
						})
						})
				}
			}
			layui.use(['transfer', 'layer', 'util'], function() {
				var $ = layui.$,
					transfer = layui.transfer,
					layer = layui.layer,
					util = layui.util;
				util.event('lay-demoTransferActive', {
					getData: function(othis) {
						var getData = transfer.getData('keyAddress'); //获取右侧数据
						var yuan = transfer.getData('yuan');
						var cc = [];
						var bb = [];
						for (var i = 0; i < eval(getData).length; i++) {
							cc.push(eval(getData)[i].value);
						}
						for (var i = 0; i < eval(yuan).length; i++) {
							bb.push(eval(yuan)[i].value);
						}
						for (var i = 0; i < cc.length; i++) {
							for (var j = 0; j < d4.length; j++) {
								if(d4[j]==cc[i]){
									d4.splice(j,1);
									cc.splice(i,1);
								}
							}
						}
						for (var i = 0; i < bb.length; i++) {
							for (var j = 0; j < d3.length; j++) {
								if(d3[j]==bb[i]){
									d3.splice(j,1);
									bb.splice(i,1);
								}
							}
						}
						cc=[...new Set(cc)];
						bb=[...new Set(bb)];
						console.log(d3);//小件员本来有现已移除
						console.log(d4);//地址本来有现已移除
						console.log(bb);//小件员新增
						console.log(cc);//地址新增
						
						
					}
				});
				})
				//加载'form'模块，使checkbox、select、radio初始化
				layui.use('form', function() {

				});
				$(function() {
						$.ajaxSetup({
								dataType: "json",
								cache: false,
								headers: {
									"Authorization": 'bos' + $.cookie('user')
								},
								xhrFields: {
									withCredentials: true
								}
								/* ,
						complete: function(xhr) {
						    //token过期，则跳转到登录页面
						    if(xhr.responseJSON.code == 401){
						        parent.location.href = baseURL + 'login.html';
						    }
						} */
							});
							$.ajax({
								url: url + 'syUnitsController/findSyUnits',
								type: 'post',
								async: false,
								success: function(data) {
									var gong=data.SyUnits[0];
									for (var i = 0; i < gong.length; i++) {
										$("#dw").append('<option value="'+gong[i].id+'">'+gong[i].name+'</option>');
									}
								}
							});
							
					})
			//注意：选项卡 依赖 element 模块，否则无法进行功能性操作
			layui.use('element', function() {
				var element = layui.element;

				//…
			});
			var turnNum = function(nums) {
				for (let i = 0; i < nums.length; i++) {
					nums[i] = parseInt(nums[i])
				}
				return nums;
			}
		</script>
	</body>
</html>
