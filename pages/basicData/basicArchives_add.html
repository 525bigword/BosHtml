<!DOCTYPE html> 
<html lang="en"> 
<head> 
    <meta charset="utf-8"> 
    <meta name="viewport" content="width=device-width, initial-scale=1"> 
    <title>基础档案</title> 
    <link rel="stylesheet" type="text/css" href="../../layui/css/layui.css">
</head> 
<body>
	<form class="layui-form">
	<table class="layui-table" style="width: 98%;margin: 1px auto;text-align: center;">
	  	<tbody>
		    <tr>
		    	<td class="layui-bg-gray" width="15%">档案名称</td>
		      	<td width="35%">
      				<input type="text" id="name"   name="title" placeholder="请输入基本档案名称" autocomplete="off" class="layui-input">
		      	</td>
		      	<td class="layui-bg-gray" width="15%">是否分级</td>
		      	<td width="35%" id="aaa">
					<input type="radio" name="del" value="1" title="是">
					<input type="radio" name="del" value="0" title="否" checked="checked">
		      	</td>
		    </tr>
		    <tr>
		      	<td class="layui-bg-gray">操作人员</td>
		      	<td id="empName"></td>
		      	<td class="layui-bg-gray">操作单位</td>
		      	<td id="untis"></td>
		    </tr>
			<tr>
		      	<td class="layui-bg-gray">操作时间</td>
		      	<td id="time"></td>
		      	<td class="layui-bg-gray"></td>
		      	<td></td>
		    </tr>
		    <tr>
		      	<td class="layui-bg-gray">备注</td>
		      	<td colspan="3"> 
					
					<textarea name="desc" id="remarks" placeholder="请输入备注信息" class="layui-textarea"></textarea>
		      	</td>
		    </tr>
		    <tr>
		      	<td colspan="4">
					<button class="layui-btn" type="button" id="baocun" style="background: #1da02b;">确定</button>
					<button type="button" id="quxiao" class="layui-btn layui-btn-primary">取消</button>
		      	</td>
		    </tr>
	  	</tbody>
	</table>
	</form>
	<script type="text/javascript" src="../../custom/jquery.min.js"></script>
	<script type="text/javascript" src="../../layui/layui.js"></script>
	<script type="text/text/javascript" src="../js/bos.js"></script>
	<script src="../js/jquery.cookie.js"></script>
	<script type="text/javascript">
        var id;
		var grade=0;
		var st;
		var da;
        function child(d) {
			if(d!=null){
				clearInterval(st);
				id=d.id;
				$("#name").val(d.name);
				grade=d.grade;
				$("#empName").text(d.syEmp.empName);
				$("#untis").text(d.syUnits.name);
				$("#time").text(d.operationTime);
				$("#remarks").val(d.remarks);
				layui.use('form', function(){
				   var form=layui.form;
				   $("input:radio[value="+grade+"]").prop('checked','true');
				   $("#name").prop('readonly','true');
				   form.render();
				});
			}
			
			
        	
        }
        //加载'form'模块，使checkbox、select、radio初始化
        $(function(){
			
			$.ajaxSetup({
					dataType: "json",
					cache: false,
				    headers: {
				        "Authorization": 'bos'+$.cookie('user')
				    },
				    xhrFields: {
					    withCredentials: true
				    } /* ,
				    complete: function(xhr) {
				        //token过期，则跳转到登录页面
				        if(xhr.responseJSON.code == 401){
				            parent.location.href = baseURL + 'login.html';
				        }
				    } */
				}); 
					$.ajax({
						url: 'http://localhost:8089/jurisdiction/parsetoken',
						type: 'get',
						header:{
							"Authorization": 'bos'+$.cookie('user')
						},
						async: false,
						dateType: 'json',
						success: function(data) {
							da=data;
							$("#empName").text(da.map.empName);
							$("#untis").text(da.map.syUnits.name);
							getDate();
							st=setInterval(getDate, 1000);
						}
					});
			$("#baocun").click(function(){
				var name=$("#name").val();
				var gra=$("input[type=radio]:checked").val();
				var remark=$("#remarks").val();
				if(name==null||name==""){
					layer.msg('请将信息补充完整', {
						icon: 5,
						time: 800
					});
					return;
				}
				if(id!=null&&id!=""){
					if(grade==1&&gra==0){
						layer.msg('无权取消档案分级', {
							icon: 5,
							time: 800
						});
						return;
					}
					$.ajax({
						url: 'http://localhost:8089/basicArchiveController/upBasBasicArchivesById',
						type: 'post',
						async: false,
						data: {
							"id":id,
							"grade": gra,
							"remarks": remark
						},
						success: function(data) {
								var index = parent.layer.getFrameIndex(window.name);
								parent.layer.close(index);
							
						}
					});
				}else{
					$.ajax({
						url:'http://localhost:8089/basicArchiveController/saveBasBasicArchives',
						type: 'post',
						async: false,
						data: {
							"name":name,
							"grade": gra,
							"syEmp.id":da.map.id,
							"syUnits.id":da.map.syUnits.id,
							"remarks":remark
						},
						success: function(data) {
							if(data==1){
								layer.msg('基础档案名称已存在', {
									icon: 5,
									time: 1000
								});
							}else{
								var index = parent.layer.getFrameIndex(window.name);
								parent.layer.close(index);
							}
						}
					});
				}
				
			})
			$("#quxiao").click(function() {
				var index = parent.layer.getFrameIndex(window.name);
				parent.layer.close(index);
			})
		})
		function twoDigits(val) {
			if (val < 10) return "0" + val;
			return val;
		}
		
		function getDate() {
			var today = new Date();
			var date = today.getFullYear() + "-" + twoDigits(today.getMonth() + 1) + "-" + twoDigits(today.getDate()) + " ";
			var time = twoDigits(today.getHours()) + ": " + twoDigits(today.getMinutes()) + ": " + twoDigits(today.getSeconds());
			$("#time").text(date + " " + time);
		}
		layui.use('form', function() {

			});
    </script>
</body> 
</html>
    

