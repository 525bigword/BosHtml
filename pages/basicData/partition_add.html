<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>管理分区</title>
		<link rel="stylesheet" type="text/css" href="../../layui/css/layui.css">
	</head>
	<body>
		<form class="layui-form">
			<table class="layui-table" style="width: 98%;margin: 1px auto;text-align: center;">
				<tbody>
					<tr>
						<td class="layui-bg-gray" width="10%">省份</td>
						<td width="23%">
							<select name="city" id="shen" lay-filter="see" lay-verify="required">
								<option value="">请选择</option>
							</select>
						</td>
						<td class="layui-bg-gray" width="10%">城市</td>
						<td width="23%">
							<select name="city" id="shi" lay-filter="see1" lay-verify="required">
								<option value="">请选择</option>
							</select>
						</td>
						<td class="layui-bg-gray" width="10%">区（县）</td>
						<td width="23%">
							<select name="city" id="qu" lay-filter="see2" lay-verify="required">
								<option value="">请选择</option>
							</select>
						</td>
					</tr>
					<tr>
						<td class="layui-bg-gray">分拣编码</td>
						<td>
							<input type="text" id="fj" readonly="readonly" name="title" placeholder="请输入分拣编码" autocomplete="off" class="layui-input">
						</td>
						<td class="layui-bg-gray">定区编码</td>
						<td>
							<select name="city" id="dq" lay-verify="required">
								<option value="">请选择</option>
							</select>
						</td>
						<td class="layui-bg-gray">关键字</td>
						<td>
							<input type="text" id="key" name="title" placeholder="请输入关键字" autocomplete="off" class="layui-input">
						</td>

					</tr>
					<tr>
						<td class="layui-bg-gray">起始号</td>
						<td>
							<input type="text" id="start" name="title" placeholder="请输入起始号" autocomplete="off" class="layui-input">
						</td>
						<td class="layui-bg-gray">终止号</td>
						<td>
							<input type="text" id="end" name="title" placeholder="请输入终止号" autocomplete="off" class="layui-input">
						</td>
						<td class="layui-bg-gray">单双号</td>
						<td>
							<input type="radio" name="del" value="1" title="单">
							<input type="radio" name="del" value="2" title="双" checked>
						</td>
					</tr>
					<tr>
						<td colspan="6">
							<button class="layui-btn" type="button" id="baocun" style="background: #1da02b;">确定</button>
							<button type="button" id="quxiao" class="layui-btn layui-btn-primary">取消</button>
						</td>
					</tr>
				</tbody>
			</table>
		</form>
		<script type="text/javascript" src="../../custom/jquery.min.js"></script>
		<script type="text/javascript" src="../../layui/layui.js"></script>
		<script type="text/javascript" src="../js/jquery.cookie.js"></script>
		<script type="text/javascript" src="../js/bos.js"></script>
		<script type="text/javascript">
			var citys;
			var shi;
			var qu;
			var id;
			var da;
			function child(pagedate, d) {
				citys = pagedate;
				if (d != null) {
					id = d.id;
					layui.use('form', function() {
						var form = layui.form;
						for (var i = 0; i < citys.length; i++) {
							$("#shen").append('<option value="' + citys[i].name + '">' + citys[i].name + '</option>');
						}
						$("#shen").val(d.province);
						for (i = 0; i < citys.length; i++) {
							if ($("#shen").val() == citys[i].name) {
								shi = citys[i].shen;
								for (var j = 0; j < shi.length; j++) {
									$("#shi").append('<option value="' + shi[j].name + '">' + shi[j].name + '</option>');
								}

							}

						}
						$("#shi").val(d.city);
						for (var i = 0; i < shi.length; i++) {
							if ($("#shi").val() == shi[i].name) {
								qu = shi[i].shi;
								for (var j = 0; j < qu.length; j++) {
									$("#qu").append('<option value="' + qu[j].name + '">' + qu[j].name + '</option>');
								}
							}
						}
						$("#qu").val(d.county);
						$("input:radio[value=" + d.sDInt + "]").prop('checked', 'true');
						$("#fj").val(d.sortingCode);
						$("#dq").val(d.zoneCode);
						$("#dq").prop('disabled', 'disabled');
						form.render();
					})
					$("#key").val(d.keyword);
					$("#start").val(d.startInt);
					$("#end").val(d.terminateInt);
				} else {
					layui.use('form', function() {
						var form = layui.form;
						for (var i = 0; i < citys.length; i++) {
							$("#shen").append('<option value="' + citys[i].name + '">' + citys[i].name + '</option>');
						}
						form.render();
					})
					$.ajax({
						url: url + 'basPartitionController/findCode',
						type: 'post',
						async: false,
						success: function(data) {
							var gong = data;
							$("#fj").val(gong);
						}
					});
					
				}
			}
			$(function() {
				$.ajaxSetup({
					dataType: "json",
					cache: false,
					headers: {
						"Authorization": 'bos' + $.cookie('user')
					},
					xhrFields: {
						withCredentials: true
					}
					/* ,
			complete: function(xhr) {
			    //token过期，则跳转到登录页面
			    if(xhr.responseJSON.code == 401){
			        parent.location.href = baseURL + 'login.html';
			    }
			} */
				});
				$.ajax({
					url: url + 'jurisdiction/parsetoken',
					type: 'get',
					header: {
						"Authorization": 'bos' + $.cookie('user')
					},
					async: false,
					dateType: 'json',
					success: function(data) {
						da = data;
					}
				});
				$.ajax({
					url: url + 'basZoneInfoController/findBasZoneInfos',
					type: 'post',
					async: false,
					success: function(data) {
						var gong = data.BasZoneInfo[0];
						for (var i = 0; i < gong.length; i++) {
							$("#dq").append('<option value="' + gong[i].zoneCode + '">' + gong[i].zoneCode + '</option>');
						}
					}
				});
				$("#baocun").click(function() {
					var shen = $("#shen").val();
					var shi = $("#shi").val();
					var qu = $("#qu").val();
					var fj = $("#fj").val();
					var dq = $("#dq").val();
					var key = $("#key").val();
					var start = $("#start").val();
					var end = $("#end").val();
					var ds = $("input[type=radio]:checked").val();
					if (shen == null || shen == "" || shi == null || shi == "" || qu == null || qu == "" || fj == null || fj == "" ||
						dq == null || dq == "" || key == null || key == "" || start == null || start == "" || end == null || end ==
						"" || ds == null || ds == "") {
						layer.msg('请将信息补充完整', {
							icon: 5,
							time: 800
						});
						return;
					}
					console.log(shen + shi + qu + start + fj + dq + key + end + ds);
					if (id != null && id != "") {
						$.ajax({
							url: url + 'basPartitionController/upBasPartitionById',
							type: 'post',
							async: false,
							data: {
								"id": id,
								"province": shen,
								"city": shi,
								"county": qu,
								"keyword": key,
								"startInt": start,
								"terminateInt": end,
								"sDInt": ds
							},
							success: function(data) {
								var index = parent.layer.getFrameIndex(window.name);
								parent.layer.close(index);
							}
						});
					}else{
						$.ajax({
							url: url + 'basPartitionController/saveBasPartition',
							type: 'post',
							async: false,
							data: {
								"province": shen,
								"city": shi,
								"county": qu,
								"keyword": key,
								"startInt": start,
								"terminateInt": end,
								"sDInt": ds,
								"syEmp.id":da.map.syEmps.id,
								"syUnits.id":da.map.syEmps.syUnits.id,
								"sortingCode":fj,
								"zoneCode":dq
							},
							success: function(data) {
								var index = parent.layer.getFrameIndex(window.name);
								parent.layer.close(index);
							}
						});
					}
				})
				$("#quxiao").click(function() {
					var index = parent.layer.getFrameIndex(window.name);
					parent.layer.close(index);
				})
			})
			//加载'form'模块，使checkbox、select、radio初始化
			layui.use('form', function() {
				var form = layui.form;
				form.on('select(see)', function(data) {
					$("#shi").html('');
					$("#qu").html('');
					if ($("#shen").val() !== null && $("#shen").val() != "") {
						for (i = 0; i < citys.length; i++) {
							if ($("#shen").val() == citys[i].name) {
								shi = citys[i].shen;
								for (var j = 0; j < shi.length; j++) {
									$("#shi").append('<option value="' + shi[j].name + '">' + shi[j].name + '</option>');
								}

							}

						}
						for (var i = 0; i < shi.length; i++) {
							if ($("#shi").val() == shi[i].name) {
								qu = shi[i].shi;
								for (var j = 0; j < qu.length; j++) {
									$("#qu").append('<option value="' + qu[j].name + '">' + qu[j].name + '</option>');
								}
							}
						}
					}
					form.render();
				})
				form.on('select(see1)', function(data) {
					$("#qu").html('');
					for (var i = 0; i < shi.length; i++) {
						if ($("#shi").val() == shi[i].name) {
							qu = shi[i].shi;
							for (var j = 0; j < qu.length; j++) {
								$("#qu").append('<option value="' + qu[j].name + '">' + qu[j].name + '</option>');
							}
						}
					}
					form.render();
				})
			});
		</script>
	</body>
</html>
