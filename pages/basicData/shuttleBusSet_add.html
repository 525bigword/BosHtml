<!DOCTYPE html> 
<html lang="en"> 
<head> 
    <meta charset="utf-8"> 
    <meta name="viewport" content="width=device-width, initial-scale=1"> 
    <title>班车设置</title> 
    <link rel="stylesheet" type="text/css" href="../../layui/css/layui.css">
</head> 
<body>
	<form class="layui-form">
	<table class="layui-table" style="width: 98%;margin: 1px auto;text-align: center;">
	  	<tbody>
		    <tr>
		    	<td class="layui-bg-gray" width="15%">线路类型</td>
		      	<td width="35%">
      				<select name="city" id="city" lay-filter="see" lay-verify="required">
      					<option value="1" selected="selected">全部</option>
      					<option value="2">干线</option>
      					<option value="3">周边</option>
      					<option value="4">省内</option>
      					<option value="5">临时</option>
      					<option value="6">市内</option>
      				</select>
		      	</td>
		      	<td class="layui-bg-gray" width="15%">线路名称</td>
		      	<td width="35%">
					<select id="select" name="xianlu"  lay-verify="required">
					</select>
		      	</td>
		      	
		    </tr>
		    <tr>
		      	<td class="layui-bg-gray">车牌号</td>
		      	<td>
		      		<input type="text" id="carid" name="title" placeholder="请输入车牌号" autocomplete="off" class="layui-input">
		      	</td>
		      	<td class="layui-bg-gray">承运商</td>
		      	<td>
		      		<input type="text" id="gong" name="title" placeholder="请输入承运商" autocomplete="off" class="layui-input">
		      	</td>
		    </tr>
		    <tr>
		      	<td class="layui-bg-gray">车型</td>
		      	<td>
		      		<input type="text" id="carmodel" name="title" placeholder="请输入车型" autocomplete="off" class="layui-input">
		      	</td>
		      	<td class="layui-bg-gray">司机</td>
		      	<td>
		      		<input type="text" id="driver" name="title" placeholder="请输入司机" autocomplete="off" class="layui-input">
		      	</td>
		    </tr>
		    <tr>
		      	<td class="layui-bg-gray">电话</td>
		      	<td>
		      		<input type="text" id="phone" name="title" placeholder="请输入电话" autocomplete="off" class="layui-input">
		      	</td>
		      	<td class="layui-bg-gray">吨控</td>
		      	<td>
		      		<input type="number" maxlength="100000000000000" id="weight" name="title" placeholder="请输入吨控" autocomplete="off" class="layui-input">
		      	</td>
		    </tr>
		    
		    <tr>
		      	<td class="layui-bg-gray">备注</td>
		      	<td colspan="3"> 
					<textarea name="desc" id="remarks" placeholder="请输入备注信息" class="layui-textarea" style="min-height: 75px;"></textarea>
		      	</td>
		    </tr>
		    <tr>
		      	<td colspan="4">
					<button class="layui-btn" type="button" id="baocun" style="background: #1da02b;">确定</button>
					<button type="button" id="quxiao" class="layui-btn layui-btn-primary">取消</button>
		      	</td>
		    </tr>
	  	</tbody>
	</table>
	</form>
	<script type="text/javascript" src="../../custom/jquery.min.js"></script>
	<script type="text/javascript" src="../../layui/layui.js"></script>
	<script type="text/javascript" src="../js/bos.js"></script>
	<script src="../js/jquery.cookie.js"></script>
	<script type="text/javascript">
		var da;
		var id;
		function child(pagedate,d) {
			da=pagedate;
			if(d!=null){
				id=d.id;
				$("#carid").val(d.licensePlateInt);
				$("#gong").val(d.carrier);
				$("#carmodel").val(d.models);
				$("#driver").val(d.driver);
				$("#phone").val(d.telephone);
				$("#weight").val(d.ton);
				if(d.remarks!=null){
					$("#remarks").val(d.remarks);
				}
				$("#city").val(d.lineType);
				layui.use('form', function() {
					var form = layui.form; //只有执行了这一步，部分表单元素才会自动修饰成功
					
						for (var i = 0; i < da.length; i++) {
							if(da[i].lineType==d.lineType){
							$("#select").append('<option value="' + da[i].logLogistics.id + '">' + da[i].logLogistics.lineName +
								'</option>');
						}
					}
					$("#select").val(d.logLogistics.id);
					form.render();
				});
			}else{
				layui.use('form', function() {
					var form = layui.form; //只有执行了这一步，部分表单元素才会自动修饰成功
						for (var i = 0; i < da.length; i++) {
							$("#select").append('<option value="' + da[i].logLogistics.id + '">' + da[i].logLogistics.lineName +
								'</option>');
						}
					form.render();
				});
			}
		}
		
        $(function(){
			$.ajaxSetup({
					dataType: "json",
					cache: false,
					headers: {
						"Authorization": 'bos' + $.cookie('user')
					},
					xhrFields: {
						withCredentials: true
					}
					/* ,
			complete: function(xhr) {
			    //token过期，则跳转到登录页面
			    if(xhr.responseJSON.code == 401){
			        parent.location.href = baseURL + 'login.html';
			    }
			} */
				});
				$("#baocun").click(function(){
					var city=$("#city").val();
					var select=$("#select").val();
					var licensePlateInt=$("#carid").val();
					var carrier=$("#gong").val();
					var models=$("#carmodel").val();
					var driver=$("#driver").val();
					var telephone=$("#phone").val();
					var ton=$("#weight").val();
					var remarks=$("#remarks").val();
					if(licensePlateInt==null||licensePlateInt==""||carrier==null||carrier==""||models==null||models==""||driver==null||driver==""||telephone==null||telephone==""||ton==null||ton==""){
						layer.msg('请将信息填写完整', {
							icon: 5,
							time: 800
						});
						return;
					}
					if(ton<0){
						layer.msg('吨位不能为负', {
							icon: 5,
							time: 800
						});
						return;
					}
					if(id!=null&&id!=""){
						$.ajax({
							url: url+'basShuttleBusController/upBasShuttleBusById',
							type: 'post',
							async: false,
							data: {
								"id":id,
								"lineType": city,
								"logLogistics.id": select,
								"licensePlateInt":licensePlateInt,
								"carrier":carrier,
								"models":models,
								"driver":driver,
								"telephone":telephone,
								"ton":ton,
								"remarks":remarks
							},
							success: function(data) {
									var index = parent.layer.getFrameIndex(window.name);
									parent.layer.close(index);
								
							}
						});
					}
					
				})
				$("#quxiao").click(function() {
					var index = parent.layer.getFrameIndex(window.name);
					parent.layer.close(index);
				})
		})
        //加载'form'模块，使checkbox、select、radio初始化
        layui.use('form', function() {
        	var form = layui.form;
			form.on('select(see)',function(data){
				$("#select").html('');
				for (var i = 0; i < da.length; i++) {
					if(data.value==da[i].lineType){
						$("#select").append('<option value="' + da[i].logLogistics.id + '">' + da[i].logLogistics.lineName +
							'</option>');
					}
					if(data.value==0){
						$("#select").append('<option value="' + da[i].logLogistics.id + '">' + da[i].logLogistics.lineName +
							'</option>');
					}
					
				}
				form.render();
			})
        });
      
    </script>
</body> 
</html>
    

